<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>HTML + Pygame Ã‡alÄ±ÅŸma AlanÄ± (Tek Dosya)</title>

<!-- PyScript Ã§ekirdek -->
<link rel="stylesheet" href="https://pyscript.net/releases/2025.7.2/core.css" />
<script type="module" src="https://pyscript.net/releases/2025.7.2/core.js"></script>

<!-- Pygame-CE paketini getir -->
<py-config>
  packages = ["pygame-ce"]
</py-config>

<style>
  :root { color-scheme: dark light; }
  * { box-sizing: border-box; }
  body { margin: 0; background: #0b1020; color: #e6eefc; font-family: system-ui, Arial, sans-serif; }
  header { display:flex; gap:8px; align-items:center; padding:10px 12px; border-bottom:1px solid #1f2a44; position:sticky; top:0; background:#0b1020; z-index:2; }
  header .title { font-weight: 700; margin-right:auto; }
  header button, header input[type="file"] + label, header input[type="text"] {
    background:#111b33; color:#e6eefc; border:1px solid #1f2a44; border-radius:10px; padding:8px 10px; font-size:14px;
  }
  header button:hover { filter:brightness(1.1); cursor:pointer; }
  header .path { width: 260px; }
  header input[type="file"] { display:none; }
  header .upload-label { display:inline-block; cursor:pointer; }

  .grid {
    display:grid;
    grid-template-columns: 1.05fr 1.05fr 1.2fr;
    gap: 10px;
    padding: 10px;
    height: calc(100dvh - 62px);
  }
  .panel {
    display:flex;
    flex-direction:column;
    gap:8px;
    min-height:0; /* overflow Ã§alÄ±ÅŸsÄ±n */
  }
  .panel h3 { margin:0; font-size:15px; opacity:.9; }
  .editor {
    flex:1; width:100%; min-height:0; resize:none; border:1px solid #1f2a44; border-radius:12px; padding:10px; background:#0a1324; color:#e6eefc; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }
  .btnrow { display:flex; gap:8px; align-items:center; }
  .btn { background:#111b33; color:#e6eefc; border:1px solid #1f2a44; border-radius:10px; padding:8px 10px; font-size:14px; }
  .btn:hover { filter:brightness(1.1); cursor:pointer; }

  .outbox { display:flex; flex-direction:column; gap:8px; min-height:0; }
  #canvas-box { flex: 0 0 auto; border:1px solid #1f2a44; border-radius:12px; padding:8px; display:grid; place-items:center; background:#0a1324; }
  canvas#canvas { outline:1px solid #1f2a44; image-rendering: pixelated; width: 100%; height: auto; max-height: 55vh; }

  .console { flex:1; border:1px solid #1f2a44; border-radius:12px; background:#0a1324; padding:8px; overflow:auto; white-space:pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

  .hint { font-size: 12px; opacity: .75; }
  @media (max-width: 1100px) {
    .grid { grid-template-columns: 1fr; height:auto; }
    #canvas { max-height: 40vh; }
  }
</style>
</head>
<body>

<header>
  <div class="title">Ã‡alÄ±ÅŸma AlanÄ±</div>

  <!-- HÄ±zlÄ± gezinme -->
  <button id="go-html" class="btn">HTML</button>
  <button id="go-py" class="btn">Pygame</button>

  <!-- Dosya yÃ¼kleme â†’ EMFS -->
  <input id="file" type="file" accept="image/png,image/jpeg" />
  <label class="upload-label" for="file">Dosya SeÃ§</label>
  <input id="emfs-path" class="path" type="text" value="/assets/sprite.png" title="EMFS'e yazÄ±lacak hedef yol" />
  <button id="write-fs" class="btn">FS'e Yaz</button>
  <span id="status" class="hint"></span>
</header>

<div class="grid">
  <!-- Sol: HTML EditÃ¶rÃ¼ -->
  <section class="panel" id="html-panel">
    <h3>HTML BÃ¶lÃ¼mÃ¼</h3>
    <div class="btnrow">
      <button id="run-html" class="btn">HTML'yi Uygula</button>
      <span class="hint">AÅŸaÄŸÄ±daki â€œÃ–nizlemeâ€ bÃ¶lgesine basit HTMLâ€™in eklenir.</span>
    </div>
    <textarea id="html-editor" class="editor" spellcheck="false"><div style="padding:10px;border:1px dashed #334266;border-radius:8px">
  <h4 style="margin:0 0 6px 0;color:#ffd166">Merhaba! ğŸ‘‹</h4>
  <p style="margin:0">BurasÄ± HTML Ã¶nizleme alanÄ±na eklenecek Ã¶rnek bir kutu.</p>
</div></textarea>
    <div id="html-preview" class="console" style="min-height:120px"></div>
  </section>

  <!-- Orta: Pygame EditÃ¶rÃ¼ -->
  <section class="panel" id="py-panel">
    <h3>Pygame BÃ¶lÃ¼mÃ¼</h3>
    <div class="btnrow">
      <button id="run-py" class="btn">Pygame'i Ã‡alÄ±ÅŸtÄ±r</button>
      <button id="clear-console" class="btn" title="Konsolu temizle">Konsolu Temizle</button>
      <span class="hint">GÃ¶rsel iÃ§in Ã¶rn: <code>pygame.image.load("/assets/sprite.png")</code></span>
    </div>
    <textarea id="py-editor" class="editor" spellcheck="false"># Ã–RNEK Pygame-CE kodu (PyScript + tarayÄ±cÄ±)
import pygame, asyncio, os

pygame.init()
W, H = 800, 480
screen = pygame.display.set_mode((W, H))  # SaÄŸdaki &lt;canvas id="canvas"&gt; kullanÄ±lÄ±r
clock  = pygame.time.Clock()

# Opsiyonel sprite yÃ¼kle (EMFS'ten)
sprite, rect = None, None
for p in ("/assets/sprite.png", "/assets/sprite.jpg"):
    if os.path.exists(p):
        try:
            img = pygame.image.load(p)
            sprite = img.convert_alpha() if img.get_alpha() else img.convert()
            rect = sprite.get_rect(center=(W//2, H//2))
            print("YÃ¼klendi:", p)
            break
        except Exception as e:
            print("YÃ¼kleme hatasÄ±:", e)

if rect is None:
    rect = pygame.Rect(W//2-40, H//2-40, 80, 80)

vx = 3

async def main():
    running = True
    while running:
        for e in pygame.event.get():
            if e.type == pygame.QUIT:
                running = False

        rect.x += vx
        if rect.left &lt; 0 or rect.right &gt; W:
            vx *= -1

        screen.fill((24, 28, 40))
        if sprite:
            screen.blit(sprite, rect)
        else:
            pygame.draw.rect(screen, (220,70,70), rect)
            pygame.draw.rect(screen, (250,220,220), rect, 2)

        pygame.display.flip()
        await asyncio.sleep(1/60)

    pygame.quit()

asyncio.run(main())</textarea>
  </section>

  <!-- SaÄŸ: Oyun + Konsol -->
  <section class="outbox">
    <div id="canvas-box">
      <!-- Pygame-CE varsayÄ±lan olarak id="canvas" tuvalini kullanÄ±r -->
      <canvas id="canvas" width="800" height="480"></canvas>
    </div>
    <div class="btnrow">
      <span class="hint">Konsol (Python print &amp; hatalar burada gÃ¶rÃ¼nÃ¼r)</span>
    </div>
    <pre id="console" class="console"></pre>
  </section>
</div>

<script type="module">
  // ------- YardÄ±mcÄ±lar -------
  const $ = (sel) => document.querySelector(sel);
  const go = (id) => document.getElementById(id).scrollIntoView({behavior:'smooth', block:'start'});
  const statusEl = $('#status');

  // Konsola yaz (Python tarafÄ± da Ã§aÄŸÄ±racak)
  window.appendConsole = (txt) => {
    const el = $('#console');
    el.textContent += String(txt);
    el.scrollTop = el.scrollHeight;
  };

  // HTML Ã§alÄ±ÅŸtÄ±r
  $('#run-html').addEventListener('click', () => {
    const html = $('#html-editor').value;
    $('#html-preview').innerHTML = html;
  });

  // HÄ±zlÄ± gezinme
  $('#go-html').addEventListener('click', () => go('html-panel'));
  $('#go-py').addEventListener('click', () => go('py-panel'));

  // PyScript hazÄ±r olunca FS'yi al, klasÃ¶r oluÅŸtur
  let interp = null, FS = null;
  addEventListener('py:ready', async () => {
    interp = await pyscript.interpreter;      // PyScript 2025+
    FS = interp.pyodide.FS;                   // Emscripten FS
    try { FS.mkdirTree('/assets'); } catch(e){}
    appendConsole("PyScript hazÄ±r. Pygame-CE yÃ¼klendiyse kodu Ã§alÄ±ÅŸtÄ±rabilirsiniz.\n");
  });

  // Konsolu temizle
  $('#clear-console').addEventListener('click', () => {
    $('#console').textContent = '';
  });

  // DosyayÄ± EMFS'e yaz (hedef yolu kullanÄ±cÄ± belirler)
  $('#write-fs').addEventListener('click', async () => {
    const fi = $('#file');
    if (!fi.files || !fi.files[0]) { statusEl.textContent = "Dosya seÃ§in."; return; }
    if (!FS) { statusEl.textContent = "PyScript henÃ¼z hazÄ±r deÄŸil."; return; }

    const file = fi.files[0];
    const target = $('#emfs-path').value.trim() || '/assets/sprite.png';
    // klasÃ¶rÃ¼ oluÅŸtur
    const dir = target.substring(0, target.lastIndexOf('/')) || '/';
    try { FS.mkdirTree(dir); } catch(e){}

    // varsa eski dosyayÄ± sil
    try { FS.unlink(target); } catch(e){}

    const buf = new Uint8Array(await file.arrayBuffer());
    FS.writeFile(target, buf);
    statusEl.textContent = `YÃ¼klendi â†’ ${target} (${buf.length} bayt)`;
    appendConsole(`[FS] YazÄ±ldÄ±: ${target} (${buf.length} bayt)\n`);
  });

  // Pygame'i Ã§alÄ±ÅŸtÄ±r (editÃ¶rdeki Python kodunu derle & Ã§alÄ±ÅŸtÄ±r)
  $('#run-py').addEventListener('click', async () => {
    if (!interp) { appendConsole("HATA: PyScript hazÄ±r deÄŸil.\n"); return; }
    const codeUser = $('#py-editor').value;

    // 1) stdout/stderr yÃ¶nlendirmesi
    const redirect = `
import sys, js
class _W:
    def write(self, s): js.appendConsole(s)
    def flush(self): pass
sys.stdout = sys.stderr = _W()
`;

    // 2) Ã–nceki pygame oturumunu kapat (varsa) â€” Ã§akÄ±ÅŸmayÄ± azaltÄ±r
    const pre = `
try:
    import pygame
    pygame.quit()
except Exception:
    pass
`;

    // 3) KullanÄ±cÄ± kodunu Ã§alÄ±ÅŸtÄ±r
    try {
      await interp.pyodide.runPythonAsync(redirect + pre + "\\n" + codeUser);
    } catch (e) {
      appendConsole("\\n[JS] Ã‡alÄ±ÅŸtÄ±rma hatasÄ±: " + e + "\\n");
      console.error(e);
    }
  });
</script>

</body>
</html>
