<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pygame + PyScript • File Input → EMFS</title>

  <!-- PyScript çekirdek -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2025.7.2/core.css" />
  <script type="module" src="https://pyscript.net/releases/2025.7.2/core.js"></script>

  <!-- PyScript yapılandırması: pygame-ce paketini getir -->
  <py-config>
    packages = ["pygame-ce"]
  </py-config>

  <style>
    :root { color-scheme: dark light; }
    html,body{height:100%;margin:0;background:#0b1020;color:#e6eefc;font-family:system-ui,Arial,sans-serif}
    main{height:100%;display:grid;place-items:center;gap:14px}
    canvas{image-rendering:pixelated; outline:1px solid #1f2a44}
    .bar{display:flex;gap:10px;align-items:center}
    input[type=file]{background:#111b33;color:#e6eefc;padding:6px;border-radius:8px;border:1px solid #1f2a44}
    #status{opacity:.85;font-size:14px}
  </style>
</head>
<body>
  <main>
    <div class="bar">
      <input id="file" type="file" accept="image/png,image/jpeg" />
      <span id="status">PNG/JPG seçin; anında oyuna yüklenecek.</span>
    </div>
    <!-- Pygame bu canvas'a çizer -->
    <canvas id="canvas" width="640" height="360"></canvas>
  </main>

  <!-- Python kodu (standart py) -->
  <script type="py" src="main_upload.py"></script>

  <!-- JS: Dosya seç → ArrayBuffer → EMFS'e yaz -->
  <script type="module">
    document.addEventListener("py:ready", async () => {
      const inp = document.getElementById("file");
      const status = document.getElementById("status");
      const py = await pyscript.interpreter;     // PyScript 2025+
      const FS = py.pyodide.FS;                  // Emscripten FS

      try { FS.mkdirTree("/uploads"); } catch(e){}

      inp.addEventListener("change", async (ev) => {
        const file = ev.target.files?.[0];
        if (!file) return;

        const ext = (file.name.split(".").pop() || "").toLowerCase();
        let target = "/uploads/selected.png";
        if (ext === "jpg" || ext === "jpeg") target = "/uploads/selected.jpg";

        // Temizle ve yaz
        try { FS.unlink("/uploads/selected.png"); } catch(e){}
        try { FS.unlink("/uploads/selected.jpg"); } catch(e){}
        const buf = new Uint8Array(await file.arrayBuffer());
        FS.writeFile(target, buf);

        status.textContent = `Yüklendi: ${file.name} → ${target}`;
      });
    });
  </script>
</body>
</html>
